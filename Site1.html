<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Fn Tutorial by emhoracek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Fn Tutorial</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/emhoracek/fntutorial" class="btn">View on GitHub</a>
      <a href="https://github.com/emhoracek/fntutorial/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/emhoracek/fntutorial/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">

<p>Fn is a simple web framework build in Haskell.</p>
<p>This tutorial will show you how to make a very simple website with Fn.</p>
<h2 id="the-simplest-site">The Simplest Site</h2>
<p>stack build stack exec site1</p>
<p>visit localhost:3000</p>
<p>How does it work?!</p>
<p>well --- this is the source!! This page is written in &quot;Literate Haskell&quot;, so you can run it as source code. I'll take you line by line and show you what's going on.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE OverloadedStrings #-}</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">import </span><span class="dt">Web.Fn</span>
<span class="kw">import </span><span class="dt">Network.Wai</span> (<span class="dt">Response</span>, <span class="dt">Application</span>)
<span class="kw">import </span><span class="dt">Network.Wai.Handler.Warp</span> (run)
<span class="kw">import </span><span class="dt">Data.Text</span> (<span class="dt">Text</span>)</code></pre></div>
<p>These import the libraries we'll need for the website: Fn, WAI (Web Application Interface), and Warp. In Haskell, you can import modules from libraries with <code>import</code> + the module name. Then you can optionally restrict the imports to just certain things. So we're only importing &quot;Response&quot; and &quot;Application&quot; from Wai and only &quot;run&quot; from Warp.</p>
<p>Why are we importing these specific things?</p>
<ul>
<li>Fn is our web framework</li>
<li>Warp is the server</li>
<li>WAI is middleware (like it sounds, stuff in the middle between the framework and server).</li>
</ul>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Context</span> <span class="fu">=</span> <span class="dt">Context</span> {<span class="ot"> req ::</span> <span class="dt">FnRequest</span> }</code></pre></div>
<p>Next we make the context for our application. The idea is that there's data we want to access when we're preparing a Response to send out to a user. That data might be in a database, a cache, environment variables, wherever! In Fn, we wrap all those things up in a &quot;Context&quot;. Since in this part of the tutorial, we're making the simplest app possible, we're only going to worry about the most basic information the user sends us -- the request.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">RequestContext</span> <span class="dt">Context</span> <span class="kw">where</span>
 getRequest ctxt <span class="fu">=</span> req ctxt
 setRequest ctxt newRequest <span class="fu">=</span> ctxt { req <span class="fu">=</span> newRequest }</code></pre></div>
<p>These lines make <code>Context</code> an &quot;instance&quot; of <code>RequestContext</code>. Fn will use these functions, <code>getRequest</code> and <code>setRequest</code>, to help us respond to requests.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">PizzaJungle</span> <span class="fu">=</span> <span class="dt">Totoro</span> {<span class="ot"> request ::</span> <span class="dt">FnRequest</span>,
<span class="ot">                            mothersMaidenName ::</span> <span class="dt">String</span>,
<span class="ot">                            isAmbidextrous ::</span> <span class="dt">Bool</span> }</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">RequestContext</span> <span class="dt">PizzaJungle</span> <span class="kw">where</span>
  getRequest pizzaJungle <span class="fu">=</span> request pizzaJungle
  setRequest pizzaJungle newReq <span class="fu">=</span> pizzaJungle { request <span class="fu">=</span> newReq }</code></pre></div>
<p>Okay, I got very very silly here, but I want to make the point that it's not really important that your app specifically have a <code>Context</code>, but it's important that it has <em>something</em> (even a <code>PizzaJungle</code>!) that's a <code>RequestContext</code>. Also notice that you can as many and whatever fields you want in your context, as long as you also have some field (name doesn't matter!) that's an <code>FnRequest</code>.</span></p>
<h2 id="exercise">Exercise</h2>
<p>Suppose your app had the <code>AppContext</code> below.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">AppContext</span> <span class="fu">=</span> <span class="dt">AppContext</span> {<span class="ot"> fnrequest ::</span> <span class="dt">FnRequest</span>,
<span class="ot">                               secretKey ::</span> <span class="dt">Text</span> }</code></pre></div>
<p>How could you write the <code>RequestContext</code> instance for <code>AppContext</code>?</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="co">-- uncomment the next lines by deleting the &quot;--&quot;s when you have a solution!</span>
<span class="co">-- instance RequestContext AppContext where</span>
<span class="co">--   getRequest ????</span>
<span class="co">--   setRequest ????</span></code></pre></div>
<p>(Need help?)</p>
<hr />
<p>Okay, so back to <code>Context</code>. How do we actually use that?</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">site ::</span> <span class="dt">Context</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> <span class="dt">Response</span>
site ctxt <span class="fu">=</span> route ctxt [ end <span class="fu">==&gt;</span> indexHandler ]
                 <span class="ot">`fallthrough`</span> notFoundText <span class="st">&quot;Page not found.&quot;</span></code></pre></div>
<p>Our &quot;site&quot; is a way to take our Context, and turn it into a Response. Don't worry too much about it right now because I'll go into much more depth in the next part on routes!</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">indexHandler ::</span> <span class="dt">Context</span> <span class="ot">-&gt;</span> <span class="dt">IO</span> (<span class="dt">Maybe</span> <span class="dt">Response</span>)
indexHandler ctxt <span class="fu">=</span> okText <span class="st">&quot;Welcome to my first Haskell website.&quot;</span></code></pre></div>
<p>Hey, it's our first handler! This handles a request by taking a context and giving back a response (again, we'll go into more detail on just what that <code>IO (Maybe Response)</code> there means in the next part). In this case, we're going to do the same thing every time someone requests this page -- just send a message.</p>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> run <span class="dv">3000</span> waiApp</code></pre></div>
<div class="sourceCode"><pre class="sourceCode literate haskell"><code class="sourceCode haskell"><span class="ot">waiApp ::</span> <span class="dt">Application</span>
waiApp <span class="fu">=</span> toWAI (<span class="dt">Context</span> defaultFnRequest) site</code></pre></div>
<p>I said earlier that WAI is the middleware between our site and the server. This is where we use WAI. Warp expects an app, so we use Fn's &quot;toWAI&quot; function to turn an initial context and our <code>site</code> into an Application. <code>run 3000 waiApp</code> means to run the Warp server with this app on port 3000.</p>
<h2 id="exercises">Exercises</h2>
<p>Change the site and handler to use the AppContext data structure instead of Context. (You'll need to tell <code>waiApp</code> how to build an AppContext: <code>AppContext defaultFnRequest &quot;your string here&quot;</code>). Can you make the <code>indexHandler</code> return a response containing the <code>secretKey</code>?</p>

<p><a href="http://emhoracek.github.io/fntutorial/Site2.html">On to the next -></a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/emhoracek/fntutorial">Fn Tutorial</a> is maintained by <a href="https://github.com/emhoracek">emhoracek</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>


  </body>
</html>
